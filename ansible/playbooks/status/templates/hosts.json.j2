{
  "generated_at": "{{ lookup('pipe','date -u +%Y-%m-%dT%H:%M:%SZ') }}",
  "groups": {
  {% for group_name in groups_to_export %}
    "{{ group_name }}": [
    {% if group_name in groups %}
      {% for h in groups[group_name] %}
        {
          "name": "{{ h }}",
          "host": "{{ hostvars[h].ansible_host | default(h) }}",
          "provider": "{{ hostvars[h].provider | default('unknown') }}",
          "role": "{{ hostvars[h].role | default('unknown') }}"
        }{% if not loop.last %},{% endif %}
      {% endfor %}
    {% endif %}
    ]{% if not loop.last %},{% endif %}
  {% endfor %}
  }
}

