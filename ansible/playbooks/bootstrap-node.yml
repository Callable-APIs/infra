---
- name: Minimal bootstrap for new nodes (install Python and basics)
  hosts: aws
  gather_facts: false
  become: yes
  tasks:
    - name: Ensure package manager metadata is present (Amazon Linux)
      ansible.builtin.raw: |
        set -e
        if command -v dnf >/dev/null 2>&1; then sudo dnf -y makecache; else sudo yum -y makecache; fi
      changed_when: false

    - name: Install Python 3 and prerequisites
      ansible.builtin.raw: |
        set -e
        if command -v dnf >/dev/null 2>&1; then 
          sudo dnf -y install python3 python3-pip python3-setuptools
        else 
          sudo yum -y install python3 python3-pip python3-setuptools
        fi

    - name: Symlink python -> python3 if needed
      ansible.builtin.raw: |
        set -e
        if ! command -v python >/dev/null 2>&1; then sudo ln -s /usr/bin/python3 /usr/bin/python || true; fi
      changed_when: false

    - name: Verify Python is available
      ansible.builtin.raw: python3 --version
      changed_when: false

    - name: Gather facts now that Python is present
      ansible.builtin.setup:


